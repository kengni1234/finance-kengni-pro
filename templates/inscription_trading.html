{% extends "base.html" %}
{% block title %}Inscription ‚Äî Kengni Trading Academy{% endblock %}
{% block page_title %}Kengni Trading Academy{% endblock %}

{% block content %}
<style>
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&display=swap');

:root {
  --emerald:  #00c77a;
  --emerald2: #00ff9d;
  --midnight: #0f1419;
  --navy:     #1a1a2e;
  --glass:    rgba(255,255,255,0.04);
  --border:   rgba(255,255,255,0.08);
  --muted:    #a8b2d1;
  --gold:     #f5c842;
  --danger:   #ff4757;
}

/* ‚îÄ‚îÄ Arri√®re-plan grille ‚îÄ‚îÄ */
.acad-bg {
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 60px, rgba(0,199,122,0.025) 60px, rgba(0,199,122,0.025) 61px),
    repeating-linear-gradient(90deg, transparent, transparent 60px, rgba(0,199,122,0.025) 60px, rgba(0,199,122,0.025) 61px);
}
.acad-wrap { position: relative; z-index: 1; }

/* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
.acad-hero {
  text-align: center; padding: 2rem 1rem 1.5rem;
  max-width: 760px; margin: 0 auto 2rem;
}
.acad-badge {
  display: inline-flex; align-items: center; gap: .5rem;
  background: rgba(0,199,122,.1); border: 1px solid rgba(0,199,122,.3);
  color: var(--emerald); border-radius: 50px;
  padding: .3rem .9rem; font-size: .72rem; font-weight: 700;
  letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 1rem;
  font-family: 'Syne', sans-serif;
}
.acad-badge .dot {
  width: 6px; height: 6px; background: var(--emerald);
  border-radius: 50%; animation: blink 1.5s ease-in-out infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:.3} }

.acad-hero h1 {
  font-family: 'Syne', sans-serif;
  font-size: clamp(1.8rem, 4vw, 2.8rem);
  font-weight: 800; line-height: 1.15; color: #fff;
  margin-bottom: .75rem;
}
.acad-hero h1 em {
  font-style: normal;
  background: linear-gradient(90deg, var(--emerald), var(--emerald2), var(--gold));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.acad-hero p { color: var(--muted); font-size: .95rem; line-height: 1.7; max-width: 500px; margin: 0 auto; }

.scarcity {
  display: inline-flex; align-items: center; gap: .6rem;
  background: rgba(245,200,66,.07); border: 1px solid rgba(245,200,66,.25);
  color: var(--gold); border-radius: 50px;
  padding: .4rem 1.2rem; font-size: .8rem; font-weight: 600;
  margin-top: 1.2rem;
}
.scarcity i { animation: shake 2s ease-in-out infinite; }
@keyframes shake { 0%,100%{transform:rotate(0)} 15%{transform:rotate(-8deg)} 30%{transform:rotate(8deg)} }
#spots-n { font-weight: 800; font-size: 1rem; }

/* ‚îÄ‚îÄ Cartes niveau ‚îÄ‚îÄ */
.levels-grid {
  display: grid; grid-template-columns: repeat(3, 1fr);
  gap: .9rem; max-width: 820px; margin: 0 auto 2rem;
}
@media(max-width:640px){ .levels-grid { grid-template-columns: 1fr; } }
@media(max-width:900px) and (min-width:641px) { .levels-grid { grid-template-columns: 1fr 1fr; } }

.lv-card {
  position: relative; cursor: pointer; text-align: center;
  background: var(--glass); border: 1.5px solid var(--border);
  border-radius: 16px; padding: 1.3rem 1rem;
  transition: all .35s cubic-bezier(.175,.885,.32,1.275);
  overflow: hidden;
}
.lv-card:hover { transform: translateY(-6px); }
.lv-card.lv-debut:hover,  .lv-card.lv-debut.sel  { border-color: var(--emerald); box-shadow: 0 0 30px rgba(0,199,122,.2); }
.lv-card.lv-inter:hover,  .lv-card.lv-inter.sel  { border-color: #4d8bff; box-shadow: 0 0 30px rgba(77,139,255,.2); }
.lv-card.lv-avance:hover, .lv-card.lv-avance.sel { border-color: var(--gold); box-shadow: 0 0 30px rgba(245,200,66,.2); }
.lv-ico  { font-size: 2rem; margin-bottom: .5rem; }
.lv-name { font-family: 'Syne', sans-serif; font-weight: 700; color: #fff; font-size: .9rem; }
.lv-desc { font-size: .73rem; color: var(--muted); margin-top: .3rem; line-height: 1.4; }
.lv-tag  { font-size: .78rem; font-weight: 700; margin-top: .6rem; }
.lv-debut  .lv-tag { color: var(--emerald); }
.lv-inter  .lv-tag { color: #4d8bff; }
.lv-avance .lv-tag { color: var(--gold); }
.lv-check {
  position: absolute; top: .6rem; right: .6rem;
  width: 20px; height: 20px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: .65rem; opacity: 0; transition: .3s;
}
.lv-card.sel .lv-check { opacity: 1; }
.lv-debut.sel  .lv-check { background: var(--emerald); color: #000; }
.lv-inter.sel  .lv-check { background: #4d8bff; color: #fff; }
.lv-avance.sel .lv-check { background: var(--gold); color: #000; }

/* ‚îÄ‚îÄ Formulaire ‚îÄ‚îÄ */
.form-wrap {
  max-width: 640px; margin: 0 auto;
  background: rgba(26,26,46,.85);
  border: 1px solid var(--border); border-radius: 24px;
  padding: 2rem; backdrop-filter: blur(20px);
  box-shadow: 0 30px 80px rgba(0,0,0,.5);
}
@media(max-width:580px){ .form-wrap { padding: 1.3rem; } }

.fsec {
  display: flex; align-items: center; gap: .5rem;
  font-family: 'Syne', sans-serif; font-size: .68rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 2px; color: var(--emerald);
  margin: 1.6rem 0 .9rem;
}
.fsec:first-of-type { margin-top: 0; }
.fsec::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, rgba(0,199,122,.3), transparent); }
.fsec-num {
  width: 20px; height: 20px; border-radius: 50%;
  background: rgba(0,199,122,.15); border: 1px solid rgba(0,199,122,.3);
  display: flex; align-items: center; justify-content: center; font-size: .62rem;
}

.frow2 { display: grid; grid-template-columns: 1fr 1fr; gap: .9rem; }
@media(max-width:480px){ .frow2 { grid-template-columns: 1fr; } }
.fgrp { margin-bottom: 1rem; }
.flbl { display: block; font-size: .7rem; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: .7px; margin-bottom: .35rem; }
.finp, .fsel {
  width: 100%; background: rgba(255,255,255,.05);
  border: 1.5px solid var(--border); color: #e0e6f8;
  border-radius: 11px; padding: .72rem 1rem; font-size: .9rem;
  font-family: 'Inter', sans-serif; outline: none; transition: all .3s;
}
.finp::placeholder { color: #3a4d6a; }
.finp:focus, .fsel:focus {
  border-color: var(--emerald); background: rgba(0,199,122,.06);
  box-shadow: 0 0 0 4px rgba(0,199,122,.12); color: #fff;
}
.finp.err  { border-color: var(--danger); }
.finp.ok   { border-color: var(--emerald); }
.fsel      { appearance: none; cursor: pointer; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23a8b2d1' stroke-width='1.5' fill='none'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right .9rem center; }
.fsel option { background: #1a1a2e; color: #e0e6f8; }
.iwrap { position: relative; }
.iico  { position: absolute; left: .9rem; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: .82rem; pointer-events: none; transition: color .3s; }
.finp.ii { padding-left: 2.6rem; }
.fgrp:focus-within .iico { color: var(--emerald); }
.fhint { font-size: .7rem; color: var(--muted); margin-top: .25rem; }
.ferr  { font-size: .7rem; color: var(--danger); margin-top: .25rem; display: none; }

/* Capital chips */
.cap-chips { display: flex; flex-wrap: wrap; gap: .45rem; margin-top: .35rem; }
.cchip {
  padding: .3rem .8rem; border-radius: 50px; cursor: pointer;
  border: 1.5px solid var(--border); background: var(--glass);
  color: var(--muted); font-size: .76rem; transition: all .25s;
}
.cchip:hover { border-color: var(--emerald); color: var(--emerald); }
.cchip.on   { background: rgba(0,199,122,.12); border-color: var(--emerald); color: var(--emerald); font-weight: 600; }

/* Objectif radio */
.obj-grid { display: grid; grid-template-columns: 1fr 1fr; gap: .55rem; }
@media(max-width:420px){ .obj-grid { grid-template-columns: 1fr; } }
.obj-opt input[type=radio] { display: none; }
.obj-box {
  width: 100%; padding: .55rem .85rem;
  background: var(--glass); border: 1.5px solid var(--border);
  border-radius: 9px; font-size: .79rem; color: var(--muted);
  cursor: pointer; display: flex; align-items: center; gap: .45rem; transition: all .25s;
}
.obj-opt input:checked + .obj-box { background: rgba(0,199,122,.1); border-color: var(--emerald); color: #fff; }

/* Source chips */
.src-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: .45rem; }
@media(max-width:420px){ .src-grid { grid-template-columns: 1fr 1fr; } }
.schip {
  text-align: center; padding: .45rem .3rem;
  background: var(--glass); border: 1.5px solid var(--border);
  border-radius: 9px; font-size: .71rem; color: var(--muted); cursor: pointer; transition: all .25s;
}
.schip.on { background: rgba(77,139,255,.12); border-color: #4d8bff; color: #4d8bff; }

/* Submit */
.btn-enroll {
  width: 100%; padding: 1rem; margin-top: 1.4rem; border: none;
  background: linear-gradient(135deg, var(--emerald), var(--emerald2));
  color: #010d0a; border-radius: 13px; cursor: pointer;
  font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 800;
  position: relative; overflow: hidden;
  transition: all .35s cubic-bezier(.175,.885,.32,1.275);
  box-shadow: 0 8px 30px rgba(0,199,122,.3);
}
.btn-enroll:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0,199,122,.45); }
.btn-enroll:active { transform: scale(.98); }
.btn-enroll::after {
  content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.25), transparent);
  transition: left .5s;
}
.btn-enroll:hover::after { left: 100%; }

/* Trust */
.trust-row {
  display: flex; justify-content: center; gap: 1.2rem; flex-wrap: wrap;
  padding-top: 1.2rem; margin-top: 1.2rem;
  border-top: 1px solid var(--border); font-size: .72rem; color: var(--muted);
}
.trust-row span { display: flex; align-items: center; gap: .35rem; }
.trust-row i { color: var(--emerald); }

/* Flash messages */
.flash-box {
  max-width: 640px; margin: 0 auto 1.2rem;
  padding: .8rem 1.2rem; border-radius: 11px;
  font-size: .87rem; display: flex; align-items: center; gap: .5rem;
}
.flash-success { background: rgba(0,199,122,.12); border: 1px solid rgba(0,199,122,.3); color: var(--emerald); }
.flash-error   { background: rgba(255,71,87,.12);  border: 1px solid rgba(255,71,87,.3);  color: var(--danger); }

/* Overlay succ√®s */
.success-overlay {
  display: none; position: fixed; inset: 0; z-index: 2000;
  background: rgba(15,20,25,.93); backdrop-filter: blur(12px);
  align-items: center; justify-content: center; flex-direction: column;
  text-align: center; padding: 2rem;
}
.success-overlay.show { display: flex; animation: fadeIn .5s ease; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.s-ico { font-size: 4rem; margin-bottom: .9rem; animation: pop .6s .2s both; }
@keyframes pop { 0%{transform:scale(0)} 65%{transform:scale(1.25)} 100%{transform:scale(1)} }
.success-overlay h2 { font-family: 'Syne', sans-serif; font-size: 1.9rem; font-weight: 800; color: #fff; margin-bottom: .5rem; }
.success-overlay p  { color: var(--muted); max-width: 380px; line-height: 1.6; }
.btn-wa {
  display: inline-flex; align-items: center; gap: .5rem;
  background: #25d366; color: #fff; border: none; border-radius: 11px;
  padding: .75rem 1.6rem; font-size: .92rem; font-weight: 700;
  cursor: pointer; margin-top: 1.3rem; text-decoration: none;
  transition: all .3s;
}
.btn-wa:hover { background: #1ebe5c; transform: translateY(-2px); color: #fff; }
.btn-back {
  display: inline-block; margin-top: .8rem;
  color: var(--muted); font-size: .82rem; cursor: pointer; text-decoration: none;
  background: none; border: none;
}
.btn-back:hover { color: #fff; }
</style>

<div class="acad-bg"></div>
<div class="acad-wrap">

  <!-- HERO -->
  <div class="acad-hero">
    <div class="acad-badge"><span class="dot"></span> Kengni Trading Academy</div>
    <h1>Ma√Ætrisez les march√©s<br>financiers <em>avec les pros</em></h1>
    <p>Des formations structur√©es par des traders professionnels pour vous propulser vers l'ind√©pendance financi√®re.</p>
    <div class="scarcity">
      <i class="fas fa-fire"></i>
      Places restantes cette semaine :&nbsp;<span id="spots-n">7</span>
    </div>
  </div>

  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}{% for cat, msg in messages %}
  <div class="flash-box flash-{{ cat }}">
    <i class="fas fa-{{ 'check-circle' if cat == 'success' else 'exclamation-circle' }}"></i>
    {{ msg }}
  </div>
  {% endfor %}{% endif %}
  {% endwith %}

  <!-- Cartes niveau -->
  <div class="levels-grid">
    <div class="lv-card lv-debut" onclick="pickLevel(this,'D√©butant')">
      <div class="lv-check"><i class="fas fa-check"></i></div>
      <div class="lv-ico">üå±</div>
      <div class="lv-name">Formation Starter</div>
      <div class="lv-desc">Bases du trading, gestion du risque, premiers trades guid√©s</div>
      <div class="lv-tag">Niveau D√©butant</div>
    </div>
    <div class="lv-card lv-inter" onclick="pickLevel(this,'Interm√©diaire')">
      <div class="lv-check"><i class="fas fa-check"></i></div>
      <div class="lv-ico">üìä</div>
      <div class="lv-name">Formation Pro</div>
      <div class="lv-desc">Analyse technique avanc√©e, strat√©gies intraday et swing</div>
      <div class="lv-tag">Niveau Interm√©diaire</div>
    </div>
    <div class="lv-card lv-avance" onclick="pickLevel(this,'Avanc√©')">
      <div class="lv-check"><i class="fas fa-check"></i></div>
      <div class="lv-ico">üèÜ</div>
      <div class="lv-name">Formation Elite</div>
      <div class="lv-desc">Trading algorithmique, gestion de portefeuille, mentorat 1-on-1</div>
      <div class="lv-tag">Niveau Avanc√©</div>
    </div>
  </div>

  <!-- FORMULAIRE -->
  <div class="form-wrap">
    <form id="enrollForm" method="POST" action="{{ url_for('register_trading_lead') }}" novalidate>

      <!-- 1. Identit√© -->
      <div class="fsec"><span class="fsec-num">1</span>Votre Identit√©</div>
      <div class="frow2">
        <div class="fgrp">
          <label class="flbl">Nom complet *</label>
          <div class="iwrap">
            <i class="fas fa-user iico"></i>
            <input type="text" name="full_name" id="fName" class="finp ii"
                   placeholder="Jean Dupont" required autocomplete="name">
          </div>
          <div class="ferr" id="e-name">Nom requis (min. 2 caract√®res)</div>
        </div>
        <div class="fgrp">
          <label class="flbl">Adresse Email *</label>
          <div class="iwrap">
            <i class="fas fa-envelope iico"></i>
            <input type="email" name="email" id="fEmail" class="finp ii"
                   placeholder="jean@exemple.com" required autocomplete="email">
          </div>
          <div class="ferr" id="e-email">Email invalide</div>
        </div>
      </div>

      <!-- 2. WhatsApp -->
      <div class="fsec"><span class="fsec-num">2</span>Contact Direct WhatsApp</div>
      <div class="fgrp">
        <label class="flbl">Num√©ro WhatsApp * <small style="color:var(--muted);font-weight:400;">(format international)</small></label>
        <div class="iwrap">
          <i class="fab fa-whatsapp iico" style="color:#25d366;"></i>
          <input type="tel" name="whatsapp" id="fWA" class="finp ii"
                 placeholder="+237 6XX XXX XXX" required autocomplete="tel">
        </div>
        <div class="fhint"><i class="fas fa-lock" style="font-size:.65rem;"></i> Utilis√© uniquement pour vous contacter ‚Äî jamais partag√©</div>
        <div class="ferr" id="e-wa">Num√©ro requis (min. 8 chiffres)</div>
      </div>

      <!-- 3. Profil Trader -->
      <div class="fsec"><span class="fsec-num">3</span>Votre Profil de Trader</div>

      <div class="fgrp">
        <label class="flbl">Formation choisie *</label>
        <select name="level_selected" id="fLevel" class="fsel" required>
          <option value="" disabled selected>‚Äî Choisissez votre formation ‚Äî</option>
          <option value="D√©butant">üå± Formation Starter (D√©butant)</option>
          <option value="Interm√©diaire">üìä Formation Pro (Interm√©diaire)</option>
          <option value="Avanc√©">üèÜ Formation Elite (Avanc√©)</option>
        </select>
        <div class="ferr" id="e-level">Veuillez choisir un niveau</div>
      </div>

      <div class="fgrp">
        <label class="flbl">Capital de trading estim√©</label>
        <div class="cap-chips" id="capChips">
          <div class="cchip" onclick="pickCap(this,'< 500‚Ç¨')">< 500‚Ç¨</div>
          <div class="cchip" onclick="pickCap(this,'500‚Ç¨ ‚Äì 2 000‚Ç¨')">500‚Ç¨ ‚Äì 2 000‚Ç¨</div>
          <div class="cchip" onclick="pickCap(this,'2 000‚Ç¨ ‚Äì 10 000‚Ç¨')">2 000‚Ç¨ ‚Äì 10 000‚Ç¨</div>
          <div class="cchip" onclick="pickCap(this,'> 10 000‚Ç¨')">> 10 000‚Ç¨</div>
          <div class="cchip" onclick="pickCap(this,'Pas encore de capital')">Pas encore</div>
        </div>
        <input type="hidden" name="capital" id="fCap">
      </div>

      <div class="fgrp">
        <label class="flbl">Objectif principal *</label>
        <div class="obj-grid">
          <label class="obj-opt">
            <input type="radio" name="objective" value="Revenus passifs" required>
            <span class="obj-box">üí∞ Revenus passifs</span>
          </label>
          <label class="obj-opt">
            <input type="radio" name="objective" value="Reconversion professionnelle">
            <span class="obj-box">üîÑ Reconversion pro</span>
          </label>
          <label class="obj-opt">
            <input type="radio" name="objective" value="Ind√©pendance financi√®re">
            <span class="obj-box">üéØ Ind√©pendance financi√®re</span>
          </label>
          <label class="obj-opt">
            <input type="radio" name="objective" value="Diversification √©pargne">
            <span class="obj-box">üìà Diversifier mon √©pargne</span>
          </label>
        </div>
        <div class="ferr" id="e-obj">Veuillez choisir un objectif</div>
      </div>

      <div class="fgrp">
        <label class="flbl">Comment avez-vous entendu parler de nous ?</label>
        <div class="src-grid">
          <div class="schip" onclick="pickSrc(this,'Facebook')">üìò Facebook</div>
          <div class="schip" onclick="pickSrc(this,'WhatsApp')">üí¨ WhatsApp</div>
          <div class="schip" onclick="pickSrc(this,'Instagram')">üì∏ Instagram</div>
          <div class="schip" onclick="pickSrc(this,'Bouche √† oreille')">üó£Ô∏è Bouche √† oreille</div>
          <div class="schip" onclick="pickSrc(this,'Application Kengni')">üíª Application</div>
          <div class="schip" onclick="pickSrc(this,'Autre')">üîÄ Autre</div>
        </div>
        <input type="hidden" name="source" id="fSrc" value="Non renseign√©">
      </div>

      <input type="hidden" name="status" value="Nouveau">

      <button type="submit" class="btn-enroll" id="enrollBtn">
        <i class="fas fa-rocket me-2"></i>R√©server ma place maintenant
      </button>

      <div class="trust-row">
        <span><i class="fas fa-shield-alt"></i> Donn√©es s√©curis√©es</span>
        <span><i class="fas fa-lock"></i> Sans spam</span>
        <span><i class="fas fa-headset"></i> R√©ponse sous 24h</span>
        <span><i class="fas fa-times-circle"></i> Annulation libre</span>
      </div>
    </form>
  </div>

</div><!-- /acad-wrap -->

<!-- Overlay succ√®s -->
<div class="success-overlay" id="succOverlay">
  <div class="s-ico">üéâ</div>
  <h2>Inscription confirm√©e !</h2>
  <p>Bravo ! Votre demande a bien √©t√© re√ßue. Notre √©quipe vous contactera sur WhatsApp dans les prochaines heures pour finaliser votre inscription.</p>
  <a class="btn-wa" href="#" id="waLink" target="_blank">
    <i class="fab fa-whatsapp"></i> Nous contacter directement
  </a>
  <button class="btn-back" onclick="document.getElementById('succOverlay').classList.remove('show')">
    <i class="fas fa-arrow-left me-1"></i> Retour au formulaire
  </button>
</div>

<script>
/* Compteur de places */
(function(){
  const k = 'kta_s';
  let n = sessionStorage.getItem(k);
  if (!n) { n = Math.floor(Math.random()*7)+5; sessionStorage.setItem(k,n); }
  document.getElementById('spots-n').textContent = n;
  setInterval(()=>{ if(n>1){ n--; sessionStorage.setItem(k,n); document.getElementById('spots-n').textContent=n; } }, 40000);
})();

/* S√©lection niveau via cartes */
function pickLevel(card, val) {
  document.querySelectorAll('.lv-card').forEach(c=>c.classList.remove('sel'));
  card.classList.add('sel');
  document.getElementById('fLevel').value = val;
}
/* Sync select ‚Üí cartes */
document.getElementById('fLevel').addEventListener('change', function(){
  const m = {'D√©butant':'lv-debut','Interm√©diaire':'lv-inter','Avanc√©':'lv-avance'};
  document.querySelectorAll('.lv-card').forEach(c=>c.classList.remove('sel'));
  const cls = m[this.value];
  if(cls){ const c=document.querySelector('.'+cls); if(c) c.classList.add('sel'); }
});

/* Capital */
function pickCap(el,v){ document.querySelectorAll('.cchip').forEach(c=>c.classList.remove('on')); el.classList.add('on'); document.getElementById('fCap').value=v; }

/* Source */
function pickSrc(el,v){ document.querySelectorAll('.schip').forEach(c=>c.classList.remove('on')); el.classList.add('on'); document.getElementById('fSrc').value=v; }

/* Validation temps r√©el */
const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
document.getElementById('fName').addEventListener('input',function(){
  const ok=this.value.trim().length>=2;
  this.classList.toggle('ok',ok); this.classList.toggle('err',!ok&&this.value.length>0);
  document.getElementById('e-name').style.display=(!ok&&this.value.length>0)?'block':'none';
});
document.getElementById('fEmail').addEventListener('input',function(){
  const ok=emailRe.test(this.value);
  this.classList.toggle('ok',ok); this.classList.toggle('err',!ok&&this.value.length>0);
  document.getElementById('e-email').style.display=(!ok&&this.value.length>0)?'block':'none';
});
document.getElementById('fWA').addEventListener('input',function(){
  const ok=this.value.replace(/\s/g,'').length>=8;
  this.classList.toggle('ok',ok); this.classList.toggle('err',!ok&&this.value.length>0);
  document.getElementById('e-wa').style.display=(!ok&&this.value.length>0)?'block':'none';
});

/* Submit validation */
document.getElementById('enrollForm').addEventListener('submit',function(e){
  let ok=true;
  if(document.getElementById('fName').value.trim().length<2){ document.getElementById('e-name').style.display='block'; document.getElementById('fName').classList.add('err'); ok=false; }
  if(!emailRe.test(document.getElementById('fEmail').value)){ document.getElementById('e-email').style.display='block'; document.getElementById('fEmail').classList.add('err'); ok=false; }
  if(document.getElementById('fWA').value.replace(/\s/g,'').length<8){ document.getElementById('e-wa').style.display='block'; document.getElementById('fWA').classList.add('err'); ok=false; }
  if(!document.getElementById('fLevel').value){ document.getElementById('e-level').style.display='block'; ok=false; }
  if(!document.querySelector('input[name="objective"]:checked')){ document.getElementById('e-obj').style.display='block'; ok=false; }
  if(!ok){ e.preventDefault(); return; }
  const btn=document.getElementById('enrollBtn');
  btn.innerHTML='<i class="fas fa-spinner fa-spin me-2"></i>Inscription en cours...';
  btn.disabled=true;
});

/* Overlay succ√®s apr√®s redirect */
{% if success %}
(function(){
  const overlay=document.getElementById('succOverlay');
  const wa='{{ wa }}';
  overlay.classList.add('show');
  if(wa){ document.getElementById('waLink').href='https://wa.me/'+wa.replace(/\D/g,''); }
})();
{% endif %}
</script>
{% endblock %}